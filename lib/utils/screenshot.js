import e from"node:path";import t from"../../../../lib/puppeteer/puppeteer.js";import a from"./data.js";import r from"./version.js";import s from"../config/index.js";import{YunzaiPath as i,PluginName as n,ResPath as o}from"../dir.js";export async function screenshot(s,l,c={}){const[m,d]=s.split("/"),u=o;a.createDir(`data/html/${n}/${m}/${d}`,"root");const f={...l,_plugin:n,saveId:l.saveId||l.save_id||d,tplFile:e.resolve(o,m,d+".html"),pluResPath:u,_res_path:u,pageGotoParams:{waitUntil:"networkidle0"},sys:{scale:p(c.scale||1),copyright:`Created By ${r.yunzaiName}<span class="version">v${r.yunzaiVer}</span> & ${r.pluginName}<span class="version">v${r.pluginVer}</span>`},quality:100};if(process.argv.includes("web-debug")){const e=i+"/data/ViewData/";await a.exists(e)||a.createDir(e);const t=e+d+".json";await a.writeJSON(t,{...f,_app:m})}const h=await t.screenshot(`${n}/${m}/${d}`,f);if(c.send&&h&&c.e){const e=await c.e.reply(h);return!c.retMsgId||e}return h}function p(e=1){let t=s.other.renderScale;return t=Math.min(2,Math.max(.5,t/100)),`style='transform:scale(${e*=t})'`}