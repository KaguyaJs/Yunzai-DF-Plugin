import r from"../config/index.js";import t from"node-fetch";import{HttpsProxyAgent as e}from"https-proxy-agent";import o from"./logger.js";export class Request{async get(n,s="json",u={}){const{log:a=!0,...c}=u;r.proxy.open&&r.proxy.url&&(c.agent=new e(r.proxy.url));try{a&&o.debug(`GET请求URL: ${o.green(n)}`);const r=await t(n,{method:"GET",...c});if(!r.ok&&"raw"!==s)return o[a?"error":"debug"](`GET 请求失败：${r.status} ${r.statusText}`),!1;switch(s){case"raw":return r;case"text":return r.text();default:return r.json()}}catch(r){return o[a?"error":"debug"]("GET请求失败:",r),!1}}async post(n,s,u="json",a={}){const{log:c=!0,...g}=a;r.proxy.open&&r.proxy.url&&(g.agent=new e(r.proxy.url));try{c&&o.debug(`POST请求URL: ${o.green(n)}`);const r=await t(n,{method:"POST",body:JSON.stringify(s),...g});if(!r.ok&&"raw"!==u)return o[c?"error":"debug"](`POST 请求失败：${r.status} ${r.statusText}`),!1;switch(u){case"raw":return r;case"text":return r.text();default:return r.json()}}catch(r){return o[c?"error":"debug"]("POST请求失败:",r),!1}}}export const request=new Request;