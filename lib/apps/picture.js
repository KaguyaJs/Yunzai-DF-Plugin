import e from"../config/index.js";import{apiHandlers as r,FacePoke as t}from"../modules/index.js";import{FaceAlias as n,FaceList as i,FaceAliasIndex as s}from"../data/index.js";const c=new RegExp(`^#?(?:来张|看看|随机)(${r.map(e=>`(?:${e.reg instanceof RegExp?e.reg.source:e.reg})$`).join("|")})`,"i"),a=new RegExp(`^#?(?:来张|看看|随机)(${Object.entries(n).flatMap(([e,r])=>[e,...r]).map(e=>`(?:${e})`).join("|")})$`,"i");export class RandomPictures extends plugin{constructor(){super({name:"DF:随机图片",dsc:"随机图片小功能",event:"message",priority:500,rule:[{reg:c,fnc:"apiPicture"},{reg:a,fnc:"facePicture"}]})}async apiPicture(t=this.e){if(!e.Picture.open)return!1;const n=c.exec(t.msg)?.[1]?.toLowerCase();if(!n)return!1;const i=r.find(e=>(e.reg instanceof RegExp?e.reg:new RegExp(e.reg,"i")).test(n))?.fnc;if(!i)return!1;const s=await i();return!!s&&(await t.reply(s),!0)}async facePicture(r=this.e){if(!e.Picture.open)return!1;const n=a.exec(r.msg)?.[1];if(!n)return!1;const c=i.includes(n)?n:s[n]??"";return!!c&&(await r.reply(segment.image(await t(c))),!0)}}