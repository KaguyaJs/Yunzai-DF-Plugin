import e from"../config/index.js";import{apiHandlers as r,FacePoke as i}from"../modules/index.js";import{FaceList as t,FaceAliasIndex as n,FaceNames as c}from"../data/index.js";const s=r.map(e=>`(?:${e.reg instanceof RegExp?e.reg.source:e.reg})$`),a=new RegExp(`^#?(?:来张|看看|随机)(${s.join("|")})`,"i"),o=new RegExp(`^#?(?:来张|看看|随机)(${c.map(e=>`(?:${e})`).join("|")})$`,"i");export class RandomPictures extends plugin{constructor(){super({name:"DF:随机图片",dsc:"随机图片小功能",event:"message",priority:500,rule:[{reg:a,fnc:"apiPicture"},{reg:o,fnc:"facePicture"},{reg:/^#?DF(?:随机)?(?:表情|图片)列表$/i,fnc:"pictureList"}]})}async apiPicture(i=this.e){if(!e.Picture.open||!e.Picture.apiPicture)return logger.mark("随机api图片已禁用"),!1;const t=a.exec(i.msg)?.[1]?.toLowerCase();if(!t)return!1;const{fnc:n,name:c}=r.find(e=>(e.reg instanceof RegExp?e.reg:new RegExp(e.reg,"i")).test(t))??{};if(!n)return!1;if(c&&e.Picture.apiDisable.includes(c))return logger.mark(`随机图片 ${c} 已被禁用`),!1;const s=await n();return!!s&&(await i.reply(s),!0)}async facePicture(r=this.e){if(!e.Picture.open||!e.Picture.facePicture)return logger.mark("随机表情已禁用"),!1;const c=o.exec(r.msg)?.[1];if(!c)return!1;const s=t.includes(c)?c:n[c]??"";return!!s&&(e.Picture.faceDisable.includes(s)?(logger.mark(`随机表情 ${s} 已禁用`),!1):(await r.reply(segment.image(await i(s))),!0))}pictureList(e=this.e){return e.reply(`支持的表情:\n\n${[...s,...c].join("、")}\n\n使用 #来张 + 表情名称 使用`)}}