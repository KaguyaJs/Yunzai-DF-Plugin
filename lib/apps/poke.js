import e from"../config/index.js";import t from"lodash";import{Data as r,logger as i}from"../utils/index.js";import{FaceList as s}from"../data/index.js";import{FacePoke as n}from"../modules/index.js";export class Poke extends plugin{constructor(){super({name:"DF:戳一戳",dsc:"戳一戳回复内容",event:"notice.*.poke",priority:-114,rule:[{fnc:"poke",log:!1}]})}LogText=`${Array.isArray(Bot.uin)?i.blue("[ DF-Plugin ]"):""}${i.green("[戳一戳]")}`;async poke(){let{chuo:r,mode:s}=e.Poke;if(!r)return!1;if(this.e.target_id!==this.e.self_id)return!1;switch("random"===s&&(s=t.sample(["image","text","mix"]),i.debug(`${this.LogText} 随机选择 ${s}`)),s){case"image":{i.info(`${this.LogText} 图片模式`);const e=await this.Image();return!!e&&this.e.reply(e)}case"text":{i.info(`${this.LogText} 文本模式`);const e=this.Text();return!!e&&this.e.reply(e)}case"mix":{i.info(`${this.LogText} 混合模式`);const e=[],r=await this.Image(),s=this.Text();return s&&e.push(s),r&&e.push(r),!t.isEmpty(e)&&this.e.reply(e)}default:return i.warn("不支持的戳一戳模式: ",s),!1}}async Image(){const{imageType:r,imageBlack:o}=e.Poke;let a;if("all"===r){let e=s;Array.isArray(o)&&o.length>0&&(e=s.filter(e=>!o.includes(e))),a=t.sample(e),i.mark(`${this.LogText} 表情随机选择 ${a}`)}else a=s[r];if(!a)return i.warn(`${this.LogText} 获取表情包属性失败`),null;i.debug(`${this.LogText} 获取 ${a} 图片`);const l=await n(a);return l?segment.image(l):(i.warn(`${this.LogText} 获取戳一戳图片失败，返回为空`),null)}Text(){const{textMode:s,textList:n}=e.Poke;if("hitokoto"===s){const e=r.getJSON("json/PokeText.json","res",!0);if(!(Array.isArray(e)&&e.length>0))return i.warn(`${this.LogText} 获取一言文字失败，返回内容为空`),null;const s=t.sample(e);return i.debug(`${this.LogText} 获取一言文字:`,s),s||null}if("list"===s){if(!(Array.isArray(n)&&n.length>0))return i.warn(`${this.LogText} 获取自定义戳一戳文本失败，返回为空`),null;const e=t.sample(n);return i.debug(`${this.LogText} 获取自定义文本:`,e),e||null}return null}}