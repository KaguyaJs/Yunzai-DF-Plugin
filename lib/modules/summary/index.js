import t from"../../config/index.js";import{logger as e,request as m}from"../../utils/index.js";import r from"lodash";let a,i,o=!1,s="off";export default new class{init(e){e&&"off"===s?(s="on",a=segment.image,i=this.getSummaryText("ciallo"),2===t.summary.type&&this.getSummaryText(t.summary.type),segment.image=(...e)=>{const m=a(...e);return m.summary??=this.getSummaryText(t.summary.type),m}):"function"==typeof a&&"on"===s&&(s="off",segment.image=a)}getSummaryText(e){switch(e){case 1:return t.summary.text;case 2:{const t=i;return this.upHitokotoText(),t}case 3:return r.sample(t.summary.list)??this.getSummaryText("ciallo");default:return"Ciallo ~ (∠・ω< )⌒★"}}async upHitokotoText(){if(!o){o=!0;try{const r=await m.get(t.summary.api,"text",{log:!1});if(!r)return void e.debug("一言外显更新失败");i=r}catch(t){e.error(`获取一言接口时发生错误：${t}`)}finally{o=!1}}}};